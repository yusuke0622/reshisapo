<%= render partial: 'layouts/flash' %>
<div class="container mt-5">
    <div class="col-md-10">
        <div class="row col-md-8">
            <h2>
                <%= @recipe.recipe_name %>
            </h2>
            <div class="col-md-5 ml-md-4">
                <% if @recipe.favorited?(current_user) %>
                    お気に入り登録
                    <%= link_to recipe_favorites_path(@recipe.id), method: :delete do %>
                       <i class="fa-regular fa-heart"></i>
                    <% end %>
                <% else %>
                    お気に入り解除
                    <%= link_to recipe_favorites_path(@recipe.id), method: :post do %>
                        <i class="fa-solid fa-heart-circle-minus"></i>
                    <% end %>
                <% end %>
            </div>
        </div>
        <div class="col-md-5">
            <%= link_to user_path(@recipe.user.id) do %>
                <% if @recipe.user.user_icon.present? %>
                    <%= image_tag @recipe.user.user_icon.variant(resize: "60x60") %>
                <% else %>
                    <%= image_tag 'no_image.jpg', :size => "60x60" %>
                <% end %>
                <h4 class="text-center"><%= @recipe.user.name %></h4>
            <% end %>
        </div>
        <div class="row mt-4">
            <div class="col-md-6 align-baseline">
                <% if @recipe.recipe_image.attached? %> 
                    <%= image_tag @recipe.recipe_image.variant(resize: "500x450") %>
                <% else %>
                    <%= image_tag 'no_image.jpg', :size => "100x100" %>
                <% end %>
            </div>
            <div class="col-md-5 ml-5 d-flex flex-column align-items-start justify-content-center">
                <h3>
                    <%= link_to category_recipes_path(category_id: @category.id) do %>
                        <%= @recipe.category.category_name %>
                    <% end %>
                </h3>
                <% @recipe.tags.each do |tag| %>
                    <div class="tag-list">
                        <%= link_to tag_recipes_path(tag_id: tag.id) do %>
                            <h3><%= tag.tag_name %></h3>
                        <% end %>
                    </div>
                <% end %>
                <h4><%= @recipe.introduction %></h4>
            </div>
        </div>
        <div class="col-md-12 mt-5">
            <h2>材料（<%= @recipe.serving %>人分）</h2>
            <table class="table table-borderless">
                <tr>
                    <th>食材・調味料</th>
                    <th>分量</th>
                </tr>
                <% @recipe.ingredients.each do |ingredient| %>
                <tr>
                    <td><%= ingredient.ingredient_name %></td>
                    <td><%= ingredient.quantity %></td>
                </tr>
                <% end %>
            </table>
        </div>
        <div class="col-md-12">
            <div class="col-md-8">
                <h2>作り方</h2>
            </div>
            <div class="d-flex flex-warp flex-column">
                <% @recipe.steps.each do |step| %>
                    <div class="col-md-6">
                        <div class="col-md-2">
                            <h3 class="border border-dark"><%= step.number %></h3>
                        </div>
                        <div>
                            <% if step.step_image.attached? %>
                                <%= image_tag step.step_image.variant(resize: "300x200") %>
                            <% else %>
                                <%= image_tag 'no_image.jpg', :size => "100x100" %>
                            <% end %>
                        </div>
                        <div class="mt-1">
                            <h5><%= step.explanation %></h5>
                        </div>
                    </div>
                <% end %>
            </div>
            <div class="col-md-12">
                  <%= form_with(model:[@recipe, @comment], method: :post) do |f| %>
                        <div class="col-md-8">
                            <h3>コメント</h3>
                        </div>
                        <div class="form-group">
                            <%= f.text_area :content, row: 3, class: 'col-md-8' %>
                            <%= f.hidden_field :recipe_id, value: @recipe.id %><br>
                            <%= f.submit 'コメントする', class: 'btn btn-outline-secondary' %>
                        </div>
                    <% end %>
                    <div class="col-md-8">
                        <h2>コメント一覧</h2>
                    </div>
                    <% @comments.each do |comment| %>
                        <div class="col-md-10">
                            <%= comment.user.name %>
                            <%= comment.content %>
                        </div>
                        <% if current_user.id == comment.user_id %>
                            <%= link_to "削除", recipe_comment_path(@recipe, comment), method: :delete %>
                            <%= link_to "編集", edit_recipe_comment_path(@recipe, comment) %>
                        <% elsif current_user.id == @recipe.user_id %>
                            <%= link_to "削除", recipe_comment_path(@recipe, comment), method: :delete, data: { confirm: "本当に削除しますか？" } %>
                        <% end %>
                    <% end %>
             </div>
            
        </div>
        <% if @recipe.user_id == current_user.id %>
            <div class="row text-center">
                <%= link_to '編集', edit_recipe_path(@recipe.id) %>
                <%= link_to '削除', recipe_path(@recipe.id), method: :delete, data: { confirm: "本当に削除しますか?" } %>
            </div>
        <% end %>
    </div>
